#!/usr/bin/env python3

import rospy
from kmriiwa_msgs.msg import JointPosition

def main():
    # Initialize the ROS node
    rospy.init_node('robot_control', anonymous=True)

    # Publisher for arm joint positions
    arm_pub = rospy.Publisher('/kmriiwa/arm/command/JointPosition', JointPosition, queue_size=10)

    # Define the rate at which to publish (10 Hz)
    rate = rospy.Rate(10)

    # Define the different joint positions (original, position 1, position 2)
    original_pos = JointPosition()
    original_pos.header.seq = 0
    original_pos.header.stamp = rospy.Time.now()
    original_pos.header.frame_id = ''
    original_pos.a1 = 0.0
    original_pos.a2 = 0.0
    original_pos.a3 = 0.0
    original_pos.a4 = 0.0
    original_pos.a5 = 0.0
    original_pos.a6 = 0.0
    original_pos.a7 = 0.0

    pos1 = JointPosition()
    pos1.header.seq = 0
    pos1.header.stamp = rospy.Time.now()
    pos1.header.frame_id = ''
    pos1.a1 = 0.6
    pos1.a2 = 0.5
    pos1.a3 = -0.5
    pos1.a4 = 0.2
    pos1.a5 = 0.0
    pos1.a6 = 0.5
    pos1.a7 = -0.6

    pos2 = JointPosition()
    pos2.header.seq = 0
    pos2.header.stamp = rospy.Time.now()
    pos2.header.frame_id = ''
    pos2.a1 = 0.6
    pos2.a2 = 0.5
    pos2.a3 = 0.5
    pos2.a4 = 0.2
    pos2.a5 = 0.0
    pos2.a6 = 0.5
    pos2.a7 = 0.6

    # Create a list of positions to move through
    positions = [original_pos, pos1, pos2, original_pos]

    # Loop through the positions
    while not rospy.is_shutdown():
        for pos in positions:
            # Update the timestamp for each position
            pos.header.stamp = rospy.Time.now()

            # Publish the current joint position
            arm_pub.publish(pos)

            # Log the published message
            rospy.loginfo("Published arm joint positions: %s", pos)

            # Sleep to maintain the loop rate
            rate.sleep()

if __name__ == '__main__':
    try:
        main()
    except rospy.ROSInterruptException:
        pass
